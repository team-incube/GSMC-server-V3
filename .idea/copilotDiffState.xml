<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/DeleteEvidenceServiceImpl.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/DeleteEvidenceServiceImpl.kt" />
              <option name="originalContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.DeleteEvidenceService&#10;import com.team.incube.gsmc.v3.domain.score.repository.ScoreExposedRepository&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.springframework.stereotype.Service&#10;import org.springframework.transaction.annotation.Transactional&#10;&#10;@Service&#10;@Transactional&#10;class DeleteEvidenceServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;    private val scoreExposedRepository: ScoreExposedRepository,&#10;) : DeleteEvidenceService {&#10;    override fun execute(evidenceId: Long) {&#10;        evidenceExposedRepository.findById(evidenceId)&#10;            ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;        scoreExposedRepository.updateEvidenceIdToNull(evidenceId)&#10;        evidenceExposedRepository.deleteById(evidenceId)&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.DeleteEvidenceService&#10;import com.team.incube.gsmc.v3.domain.score.repository.ScoreExposedRepository&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.jetbrains.exposed.sql.transactions.transaction&#10;import org.springframework.stereotype.Service&#10;&#10;@Service&#10;class DeleteEvidenceServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;    private val scoreExposedRepository: ScoreExposedRepository,&#10;) : DeleteEvidenceService {&#10;    override fun execute(evidenceId: Long) = transaction {&#10;        evidenceExposedRepository.findById(evidenceId)&#10;            ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;        scoreExposedRepository.updateEvidenceIdToNull(evidenceId)&#10;        evidenceExposedRepository.deleteById(evidenceId)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/FindEvidenceByIdServiceImpl.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/FindEvidenceByIdServiceImpl.kt" />
              <option name="originalContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.presentation.data.response.GetEvidenceResponse&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.FindEvidenceByIdService&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.springframework.stereotype.Service&#10;import org.springframework.transaction.annotation.Transactional&#10;&#10;@Service&#10;@Transactional(readOnly = true)&#10;class FindEvidenceByIdServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;) : FindEvidenceByIdService {&#10;    override fun execute(evidenceId: Long): GetEvidenceResponse {&#10;        val evidence =&#10;            evidenceExposedRepository.findById(evidenceId)&#10;                ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;&#10;        return GetEvidenceResponse(&#10;            id = evidence.id,&#10;            title = evidence.title,&#10;            content = evidence.content,&#10;            createdAt = evidence.createdAt,&#10;            updatedAt = evidence.updatedAt,&#10;            files = evidence.files,&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.presentation.data.response.GetEvidenceResponse&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.FindEvidenceByIdService&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.jetbrains.exposed.sql.transactions.transaction&#10;import org.springframework.stereotype.Service&#10;&#10;@Service&#10;class FindEvidenceByIdServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;) : FindEvidenceByIdService {&#10;    override fun execute(evidenceId: Long): GetEvidenceResponse = transaction {&#10;        val evidence =&#10;            evidenceExposedRepository.findById(evidenceId)&#10;                ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;&#10;        GetEvidenceResponse(&#10;            id = evidence.id,&#10;            title = evidence.title,&#10;            content = evidence.content,&#10;            createdAt = evidence.createdAt,&#10;            updatedAt = evidence.updatedAt,&#10;            files = evidence.files,&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/UpdateEvidenceServiceImpl.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/kotlin/com/team/incube/gsmc/v3/domain/evidence/service/impl/UpdateEvidenceServiceImpl.kt" />
              <option name="originalContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.presentation.data.response.PatchEvidenceResponse&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.UpdateEvidenceService&#10;import com.team.incube.gsmc.v3.domain.file.repository.FileExposedRepository&#10;import com.team.incube.gsmc.v3.domain.score.repository.ScoreExposedRepository&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.springframework.stereotype.Service&#10;import org.springframework.transaction.annotation.Transactional&#10;&#10;@Service&#10;@Transactional&#10;class UpdateEvidenceServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;    private val scoreExposedRepository: ScoreExposedRepository,&#10;    private val fileExposedRepository: FileExposedRepository,&#10;) : UpdateEvidenceService {&#10;    override fun execute(&#10;        evidenceId: Long,&#10;        participants: List&lt;Long&gt;?,&#10;        title: String?,&#10;        content: String?,&#10;        fileIds: List&lt;Long&gt;?,&#10;    ): PatchEvidenceResponse {&#10;        val evidence = evidenceExposedRepository.findById(evidenceId)&#10;            ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;        if (!fileIds.isNullOrEmpty() &amp;&amp; !fileExposedRepository.existsByIdIn(fileIds)) {&#10;            throw GsmcException(ErrorCode.FILE_NOT_FOUND)&#10;        }&#10;        if (!participants.isNullOrEmpty()) {&#10;            if (!scoreExposedRepository.existsByIdIn(participants)) {&#10;                throw GsmcException(ErrorCode.SCORE_NOT_FOUND)&#10;            }&#10;            scoreExposedRepository.updateEvidenceIdToNull(evidenceId)&#10;            scoreExposedRepository.updateEvidenceId(participants, evidenceId)&#10;        }&#10;        val updatedEvidence = evidenceExposedRepository.update(&#10;            id = evidenceId,&#10;            title = title ?: evidence.title,&#10;            content = content ?: evidence.content,&#10;            fileIds = fileIds ?: evidence.files.map { it.fileId!! }&#10;        )&#10;        return PatchEvidenceResponse(&#10;            id = updatedEvidence.id,&#10;            title = updatedEvidence.title,&#10;            content = updatedEvidence.content,&#10;            createAt = updatedEvidence.createdAt,&#10;            updateAt = updatedEvidence.updatedAt,&#10;            file = updatedEvidence.files,&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.team.incube.gsmc.v3.domain.evidence.service.impl&#10;&#10;import com.team.incube.gsmc.v3.domain.evidence.presentation.data.response.PatchEvidenceResponse&#10;import com.team.incube.gsmc.v3.domain.evidence.repository.EvidenceExposedRepository&#10;import com.team.incube.gsmc.v3.domain.evidence.service.UpdateEvidenceService&#10;import com.team.incube.gsmc.v3.domain.file.repository.FileExposedRepository&#10;import com.team.incube.gsmc.v3.domain.score.repository.ScoreExposedRepository&#10;import com.team.incube.gsmc.v3.global.common.error.ErrorCode&#10;import com.team.incube.gsmc.v3.global.common.error.exception.GsmcException&#10;import org.jetbrains.exposed.sql.transactions.transaction&#10;import org.springframework.stereotype.Service&#10;&#10;@Service&#10;class UpdateEvidenceServiceImpl(&#10;    private val evidenceExposedRepository: EvidenceExposedRepository,&#10;    private val scoreExposedRepository: ScoreExposedRepository,&#10;    private val fileExposedRepository: FileExposedRepository,&#10;) : UpdateEvidenceService {&#10;    override fun execute(&#10;        evidenceId: Long,&#10;        participants: List&lt;Long&gt;?,&#10;        title: String?,&#10;        content: String?,&#10;        fileIds: List&lt;Long&gt;?,&#10;    ): PatchEvidenceResponse = transaction {&#10;        val evidence = evidenceExposedRepository.findById(evidenceId)&#10;            ?: throw GsmcException(ErrorCode.EVIDENCE_NOT_FOUND)&#10;&#10;        // 파일 ID 검증&#10;        if (!fileIds.isNullOrEmpty() &amp;&amp; !fileExposedRepository.existsByIdIn(fileIds)) {&#10;            throw GsmcException(ErrorCode.FILE_NOT_FOUND)&#10;        }&#10;&#10;        // 참가자 검증 (participants가 scoreIds를 의미한다고 가정)&#10;        if (!participants.isNullOrEmpty()) {&#10;            if (!scoreExposedRepository.existsByIdIn(participants)) {&#10;                throw GsmcException(ErrorCode.SCORE_NOT_FOUND)&#10;            }&#10;&#10;            // 기존 연결된 점수들의 증빙자료 연결 해제&#10;            scoreExposedRepository.updateEvidenceIdToNull(evidenceId)&#10;&#10;            // 새로운 점수들과 연결&#10;            scoreExposedRepository.updateEvidenceId(participants, evidenceId)&#10;        }&#10;&#10;        // 증빙자료 업데이트&#10;        val updatedEvidence = evidenceExposedRepository.update(&#10;            id = evidenceId,&#10;            title = title ?: evidence.title,&#10;            content = content ?: evidence.content,&#10;            fileIds = fileIds ?: evidence.files.map { it.fileId!! }&#10;        )&#10;&#10;        PatchEvidenceResponse(&#10;            id = updatedEvidence.id,&#10;            title = updatedEvidence.title,&#10;            content = updatedEvidence.content,&#10;            createAt = updatedEvidence.createdAt,&#10;            updateAt = updatedEvidence.updatedAt,&#10;            file = updatedEvidence.files,&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>