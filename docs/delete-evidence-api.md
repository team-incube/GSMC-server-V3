# 증빙자료 삭제 API 동작 구조

## 개요
증빙자료 삭제 API는 기존 증빙자료를 완전히 삭제하고 관련된 모든 연결을 해제하는 기능을 제공합니다.

## API 명세

### 엔드포인트
```
DELETE /api/v3/evidences/{evidenceId}
```

### 요청 헤더
```json
{
  "Authorization": "Bearer {JWT_ACCESS_TOKEN}"
}
```

### 요청 본문
```json
{}
```
요청 본문이 필요하지 않습니다.

### 응답 본문
```json
{
  "status": "OK",
  "code": 200,
  "message": "OK"
}
```

## 동작 구조

### 1. 요청 검증 단계
- **증빙자료 존재 여부 확인**: 주어진 evidenceId로 증빙자료가 존재하는지 검증
- 존재하지 않는 경우 404 에러 반환

### 2. 관련 데이터 정리
1. **점수 연결 해제**: 해당 증빙자료와 연결된 모든 점수의 evidenceId를 null로 업데이트
2. **파일 연결 해제**: evidence_file 테이블에서 해당 증빙자료와 파일 간의 매핑 관계 삭제
3. **증빙자료 삭제**: evidence 테이블에서 해당 증빙자료 레코드 삭제

### 3. 응답 반환
성공적으로 삭제된 경우 200 상태 코드와 함께 성공 메시지 반환

## 데이터베이스 트랜잭션 구조

### 관련 테이블
- **evidence**: 증빙자료 기본 정보 저장
- **score**: 점수 정보 및 증빙자료 연결 정보 저장  
- **evidence_file**: 증빙자료와 파일 간의 매핑 정보 저장

### 트랜잭션 흐름
1. **증빙자료 존재 확인**: evidence 테이블에서 해당 ID의 데이터 존재 여부 확인
2. **점수 연결 해제**: score 테이블에서 evidenceId가 해당 값인 모든 레코드의 evidenceId를 null로 업데이트
3. **파일 연결 삭제**: evidence_file 테이블에서 해당 evidenceId를 가진 모든 매핑 관계 삭제
4. **증빙자료 삭제**: evidence 테이블에서 해당 레코드 삭제

## 에러 응답

### 404 Not Found
- **증빙자료 미존재**: 요청된 evidenceId에 해당하는 증빙자료가 없는 경우

### 500 Internal Server Error
- 데이터베이스 트랜잭션 실패
- 서버 내부 오류

## 특징

### 1. 연쇄 삭제(Cascade Delete)
- 증빙자료 삭제 시 관련된 모든 연결 관계도 함께 정리
- 데이터 무결성 유지

### 2. 원자적 연산
- 모든 삭제 작업이 하나의 트랜잭션으로 처리
- 부분 삭제로 인한 데이터 불일치 방지

### 3. 안전한 삭제
- 삭제 전 존재 여부 확인으로 안전성 보장
- 연결된 점수들의 참조 무결성 유지

### 4. 완전 삭제
- 증빙자료와 관련된 모든 데이터 완전 제거
- 파일 실제 데이터는 삭제하지 않고 연결 관계만 해제 (다른 곳에서 사용할 수 있음)

## 주의사항

### 1. 복구 불가능
- 삭제된 증빙자료는 복구할 수 없음
- 삭제 전 충분한 확인 필요

### 2. 점수 연결 해제
- 해당 증빙자료와 연결된 모든 점수의 증빙자료 정보가 제거됨
- 점수 자체는 삭제되지 않고 증빙자료 연결만 해제
